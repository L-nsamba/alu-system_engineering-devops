#!/usr/bin/env bash
# Script: 3-redirection
# Installs Nginx and safely configures /redirect_me redirect

# Update and install nginx
sudo apt-get update -y
sudo apt-get install -y nginx

# Remove any existing /redirect_me block to avoid duplicates
sudo sed -i '/location \/redirect_me {/,/}/d' /etc/nginx/sites-available/default

# Insert the /redirect_me redirect inside the server block
sudo sed -i '/listen 80 default_server;/a \
    location /redirect_me {\n\
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4;\n\
    }' /etc/nginx/sites-available/default

# Test nginx configuration
sudo nginx -t

# Restart nginx safely
sudo service nginx restart
